<% 3.times do |counter| %>
  <% case counter %>
  <% when 0 then time = "Future Leagues"  %>
  <% when 1 then time = "Current Leagues"  %>
  <% when 2 then time = "Past Leagues"  %>
  <% end %>

<h2 class="center"><%= time %></h2>
  <table class= 'table'>
    <thead>
      <tr>
        <th>Name</th>
        <th>Entry fee</th>
        <th>Start date</th>
        <th>End date</th>
        <th>Rounds</th>
        <th>Players</th>
        <th>Exchanges</th>
        <th>Commissioner</th>
      </tr>
    </thead>
    <tfoot>
      <tr>
        <th>Name</th>
        <th>Entry fee</th>
        <th>Start date</th>
        <th>End date</th>
        <th>Rounds</th>
        <th>Players</th>
        <th>Exchanges</th>
        <th>Commissioner</th>
      </tr>
    </tfoot>

    <tbody>
      <% @leagues.each do |league| %>
        <% case counter %>
        <% when 0 then next unless league.start_date.future?%>
        <% when 1 then next unless league.start_date.past? && league.end_date.future?%>
        <% when 2 then next unless league.end_date.past?%>
        <% end %>
        <tr>
          <td>
            <%=link_to league.name, league_path(league.id) %>
          </td>
          <td><%= league.entry_fee %></td>
          <td>
            <%= league.start_date.strftime("%m/%d/%y %I:%M%p").downcase %>
          </td>
          <td>
            <%= league.end_date.strftime("%m/%d/%y %I:%M%p").downcase %>
          </td>
          <td><%= league.rounds %></td>
          <td><%= league.users.count %></td>
          <td><%= league.exchanges.count %></td>
          <td>
              <%= link_to User.find(league.commissioner_id).name,
                          user_path(User.find(league.commissioner_id).id)%>
          </td>

          <td>
              <% if !current_user.leagues.any? { |l| l.id == league.id }  &&
                      league.start_date.future?
              %>
                <%= link_to "Join", join_path(id:league.id), method: :post,
                                              class: "button is-rounded is-small"
                %>
              <% end %>
          </td>
          <td><%= link_to 'Show', league %></td>
          <td><%= link_to 'Edit', edit_league_path(league) %></td>
          <td><%= link_to 'Destroy', league, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>

<%= link_to 'New League', new_league_path %>
